<div class="edit-container">
  <h1>Edit Time Entry</h1>

  @if (loading()) {
  <p class="loading">Loading...</p>
  } @else if (error()) {
  <p class="error">{{ error() }}</p>
  } @else {
  <form #timeEntryForm="ngForm" (ngSubmit)="onSubmit()" class="edit-form">
    <div class="form-grid">
      <div class="form-group">
        <label for="date">Date:</label>
        <input
          type="date"
          id="date"
          name="date"
          [(ngModel)]="date"
          required
          #dateField="ngModel"
          [class.invalid]="dateField.invalid && dateField.touched"
        />
        @if (dateField.invalid && dateField.touched) {
        <span class="error-message">Date is required</span>
        }
      </div>

      <div class="form-group">
        <label for="startTime">Start Time:</label>
        <input
          type="time"
          id="startTime"
          name="startTime"
          [(ngModel)]="startTime"
          required
          #startTimeField="ngModel"
          [class.invalid]="startTimeField.invalid && startTimeField.touched"
        />
        @if (startTimeField.invalid && startTimeField.touched) {
        <span class="error-message">Start time is required</span>
        }
      </div>

      <div class="form-group">
        <label for="endTime">End Time:</label>
        <input
          type="time"
          id="endTime"
          name="endTime"
          [(ngModel)]="endTime"
          required
          #endTimeField="ngModel"
          [class.invalid]="endTimeField.invalid && endTimeField.touched"
        />
        @if (endTimeField.invalid && endTimeField.touched) {
        <span class="error-message">End time is required</span>
        }
      </div>

      <div class="form-group">
        <label for="employee">Employee:</label>
        <select
          id="employee"
          name="employeeId"
          [(ngModel)]="employeeId"
          required
          #employeeField="ngModel"
          [class.invalid]="employeeField.invalid && employeeField.touched"
        >
          <option [ngValue]="null">Select an employee</option>
          @for (employee of employees(); track employee?.id) {
          <option [ngValue]="employee?.id">{{ employee?.employeeName }}</option>
          }
        </select>
        @if (employeeField.invalid && employeeField.touched) {
        <span class="error-message">Employee is required</span>
        }
      </div>

      <div class="form-group">
        <label for="project">Project:</label>
        <select
          id="project"
          name="projectId"
          [(ngModel)]="projectId"
          required
          #projectField="ngModel"
          [class.invalid]="projectField.invalid && projectField.touched"
        >
          <option [ngValue]="null">Select a project</option>
          @for (project of projects(); track project?.id) {
          <option [ngValue]="project?.id">{{ project?.projectCode }}</option>
          }
        </select>
        @if (projectField.invalid && projectField.touched) {
        <span class="error-message">Project is required</span>
        }
      </div>

      <div class="form-group full-width">
        <label for="description">Description:</label>
        <textarea
          id="description"
          name="description"
          [(ngModel)]="description"
          rows="4"
          required
          #descriptionField="ngModel"
          [class.invalid]="descriptionField.invalid && descriptionField.touched"
        ></textarea>
        @if (descriptionField.invalid && descriptionField.touched) {
        <span class="error-message">Description is required</span>
        }
      </div>
    </div>

    @if (error()) {
    <p class="form-error">{{ error() }}</p>
    }

    <div class="form-actions">
      <button type="submit" class="save-button" [disabled]="timeEntryForm.invalid || saving()">
        {{ saving() ? 'Saving...' : 'Save' }}
      </button>
      <button type="button" class="cancel" (click)="cancel()" [disabled]="saving()">Cancel</button>
    </div>
  </form>
  }
</div>